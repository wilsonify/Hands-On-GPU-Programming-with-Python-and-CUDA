import numpy as np
from pycuda.compiler import SourceModule
import pycuda.autoinit
from pycuda import gpuarray

ShflCode = '''
__global__ void shfl_xor_ker(int *input, int * output) {

int temp = input[threadIdx.x];

temp = __shfl_xor (temp, 1, blockDim.x);

output[threadIdx.x] = temp;

}'''
if __name__ == "__main__":
    shfl_mod = SourceModule(ShflCode)
    shfl_ker = shfl_mod.get_function('shfl_xor_ker')

    dinput = gpuarray.to_gpu(np.int32(list(range(32))))
    doutout = gpuarray.empty_like(dinput)

    shfl_ker(dinput, doutout, grid=(1, 1, 1), block=(32, 1, 1))

    print('input array: %s' % dinput.get())
    print('array after __shfl_xor: %s' % doutout.get())
